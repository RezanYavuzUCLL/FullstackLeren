server {
  listen 8080;
  server_name _;
  root /app;
  index screen.html;
  
  # Health check
  location = /health { 
    return 200 "ok"; 
    add_header Content-Type text/plain;
  }
  
  # MIME types
  types {
    text/html                             html;
    text/css                              css;
    application/javascript                js;
    application/json                      json;
    application/wasm                      wasm;
    application/octet-stream              data unityweb symbols gz;
    image/png                             png;
    image/jpeg                            jpg jpeg;
  }
  
  # Gzip
  gzip on;
  gzip_static on;
  gzip_types application/javascript application/wasm application/octet-stream text/css text/html;
  
  # Permissive CORS for everything (simplest solution)
  add_header Access-Control-Allow-Origin * always;
  add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
  add_header Access-Control-Allow-Headers "*" always;
  
  # Unity WebGL specific headers (on all responses)
  add_header Cross-Origin-Opener-Policy same-origin always;
  add_header Cross-Origin-Embedder-Policy require-corp always;
  
  # Handle gzipped files
  location ~ \.gz$ {
    add_header Content-Encoding gzip;
    types {
      application/javascript                js;
      application/wasm                      wasm;
      application/octet-stream              data;
    }
  }
  
  # Try files, fallback to index
  location / {
    try_files $uri $uri.gz $uri/ =404;
  }
  
  # Block hidden files
  location ~ /\. { 
    deny all; 
  }
}
