<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
		<title>Racing Controller</title>

		<script src="https://www.airconsole.com/api/airconsole-latest.js"></script>

		<style>
			* {
				margin: 0;
				padding: 0;
				user-select: none;
				box-sizing: border-box;
			}
			body {
				width: 100vw;
				height: 100vh;
				overflow: hidden;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				font-family: Arial, sans-serif;
			}

			/* Portrait lock with overlay */
			@media (orientation: portrait) {
				body::before {
					content: "Rotate phone to landscape";
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background: black;
					color: white;
					font-size: 28px;
					display: flex;
					justify-content: center;
					align-items: center;
					z-index: 9999;
				}
			}

			/* Top title */
			#topBar {
				position: absolute;
				top: 10px;
				left: 0;
				width: 100%;
				text-align: center;
				color: white;
				font-size: 32px;
				font-weight: bold;
				text-shadow: 2px 2px 6px rgba(0, 0, 0, 0.4);
				pointer-events: none;
			}

			/* Main layout container */
			#controls {
				width: 100%;
				height: 100%;
				padding: 60px 40px 40px 40px;
				display: flex;
				justify-content: space-between;
				align-items: center;
				gap: 40px;
			}

			/* LEFT/RIGHT section */
			#steeringWrapper {
				display: flex;
				flex-direction: column;
				justify-content: center;
				gap: 40px;
				flex: 1;
			}

			#steeringButtons {
				display: flex;
				flex-direction: row;
				justify-content: space-evenly;
				width: 100%;
				gap: 40px;
			}

			/* GAS/BRAKE section */
			#actionWrapper {
				flex: 1;
				display: flex;
				flex-direction: column;
				justify-content: center;
				gap: 40px;
			}

			/* Button base style */
			.btn {
				flex: 1;
				min-width: 100px;
				min-height: 100px;
				max-width: 200px;
				aspect-ratio: 1 / 1;
				border-radius: 22px;
				border: 2px solid rgba(255, 255, 255, 0.3);
				background: rgba(255, 255, 255, 0.15);
				color: white;
				font-size: 26px;
				font-weight: bold;
				display: flex;
				flex-direction: column;
				justify-content: center;
				align-items: center;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
				transition: transform 0.08s ease-out, background 0.1s;
			}

			.btn.pressed {
				transform: scale(0.9);
				background: rgba(255, 255, 255, 0.3);
			}

			/* Special colors */
			#gasButton {
				background: linear-gradient(135deg, #10b981, #059669);
			}
			#gasButton.pressed {
				background: linear-gradient(135deg, #15d4a5, #0bbf89);
			}

			#brakeButton {
				background: linear-gradient(135deg, #ef4444, #dc2626);
			}
			#brakeButton.pressed {
				background: linear-gradient(135deg, #ff5c5c, #e03535);
			}
		</style>
	</head>

	<body onload="window.app = new App()">
		<div id="controls">
			<!-- LEFT/RIGHT -->
			<div id="steeringWrapper">
				<div id="steeringButtons">
					<div class="btn" id="leftButton" ontouchstart="app.turn(-1)" ontouchend="app.turn(0)">
						â—€<br />LEFT
					</div>

					<div class="btn" id="rightButton" ontouchstart="app.turn(1)" ontouchend="app.turn(0)">
						â–¶<br />RIGHT
					</div>
				</div>
			</div>

			<!-- GAS/BRAKE -->
			<div id="actionWrapper">
				<div class="btn" id="gasButton" ontouchstart="app.acc(true)" ontouchend="app.acc(false)">
					âš¡<br />GAS
				</div>

				<div class="btn" id="brakeButton" ontouchstart="app.brake(true)" ontouchend="app.brake(false)">
					ðŸ›‘<br />BRAKE
				</div>
			</div>
		</div>

		<script>
			/* ---------------------------------------------
   AirConsole Controller Logic (Clean & Simple)
----------------------------------------------*/
			function App() {
				let me = this;

				me.airconsole = new AirConsole({ orientation: "landscape" });

				me.state = { accelerate: false, brake: false, turnInput: 0 };
				me.last = 0;
				me.rate = 50;

				/* Add mouse fallback for PC */
				if (!("ontouchstart" in document.createElement("div"))) {
					let elems = document.getElementsByTagName("*");
					for (let e of elems) {
						let s = e.getAttribute("ontouchstart");
						let e2 = e.getAttribute("ontouchend");
						if (s) e.setAttribute("onmousedown", s);
						if (e2) e.setAttribute("onmouseup", e2);
					}
				}
			}

			App.prototype.send = function () {
				let now = Date.now();
				if (now - this.last < this.rate) return;
				this.last = now;
				this.airconsole.message(AirConsole.SCREEN, this.state);
			};

			App.prototype.turn = function (v) {
				this.state.turnInput = v;

				document.getElementById("leftButton").classList.remove("pressed");
				document.getElementById("rightButton").classList.remove("pressed");

				if (v === -1) document.getElementById("leftButton").classList.add("pressed");
				if (v === 1) document.getElementById("rightButton").classList.add("pressed");

				this.send();
			};

			App.prototype.acc = function (down) {
				this.state.accelerate = down;
				document.getElementById("gasButton").classList.toggle("pressed", down);
				this.send();
			};

			App.prototype.brake = function (down) {
				this.state.brake = down;
				document.getElementById("brakeButton").classList.toggle("pressed", down);
				this.send();
			};
		</script>
	</body>
</html>
